╔════════════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                    WAARI AI ASSISTANT - COMPLETE ARCHITECTURE DIAGRAM                                       ║
╚════════════════════════════════════════════════════════════════════════════════════════════════════════════╝


┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                         🖥️ FRONTEND (React - Port 5173)                                      │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐    │
│  │  📱 USER INTERFACE LAYER                                                                           │    │
│  ├────────────────────────────────────────────────────────────────────────────────────────────────────┤    │
│  │                                                                                                    │    │
│  │  ┌─────────────────────────────────────────────────────────────────────────────────────────┐     │    │
│  │  │  FloatingAIButton.jsx                                                                   │     │    │
│  │  │  ├─ Location: src/jsx/components/FloatingAIButton/                                     │     │    │
│  │  │  ├─ Shows: Blue floating button with AI icon (bottom-right)                           │     │    │
│  │  │  ├─ Action: onClick → Opens AIAssistant modal                                         │     │    │
│  │  │  └─ State: isAIAssistantOpen = true/false                                             │     │    │
│  │  └─────────────────────────────────────────────────────────────────────────────────────────┘     │    │
│  │         │                                                                                        │    │
│  │         │ Opens                                                                                  │    │
│  │         ▼                                                                                        │    │
│  │  ┌─────────────────────────────────────────────────────────────────────────────────────────┐     │    │
│  │  │  AIAssistant.jsx (Main Chat Modal)                                                      │     │    │
│  │  │  ├─ Location: src/jsx/layouts/AIAssistant.jsx                                          │     │    │
│  │  │  ├─ Components:                                                                         │     │    │
│  │  │  │  ├─ Header: Shows "AI Assistant" + Close button                                    │     │    │
│  │  │  │  ├─ Messages Area: Displays chat history                                           │     │    │
│  │  │  │  ├─ Input Box: User types message here                                             │     │    │
│  │  │  │  └─ Send Button: Submit message                                                    │     │    │
│  │  │  │                                                                                     │     │    │
│  │  │  └─ Flow: User sends message                                                          │     │    │
│  │  │     ├─ handleSendMessage() called                                                     │     │    │
│  │  │     ├─ Add user message to chat                                                       │     │    │
│  │  │     ├─ setIsLoading(true)                                                             │     │    │
│  │  │     │                                                                                 │     │    │
│  │  │     └─ Detect message type ◄──────────────────┐                                       │     │    │
│  │  │        ├─ Is "trip" keyword found? ─────────┐ │                                       │     │    │
│  │  │        │                        │            │ │                                       │     │    │
│  │  │        │ YES                    │ NO         │ │                                       │     │    │
│  │  │        ▼                        ▼            │ │                                       │     │    │
│  │  │    searchTrips()    handleGeneralQuestion()  │ │                                       │     │    │
│  │  │        │                        │            │ │                                       │     │    │
│  │  │        ▼                        ▼            │ │                                       │     │    │
│  │  │    (see flow below)            Predefined    │ │                                       │     │    │
│  │  │                                 responses    │ │                                       │     │    │
│  │  │        │                        │            │ │                                       │     │    │
│  │  │        └────────────┬───────────┘            │ │                                       │     │    │
│  │  │                     ▼                        │ │                                       │     │    │
│  │  │             generateTripResponse()            │ │                                       │     │    │
│  │  │                  ↓                           │ │                                       │     │    │
│  │  │             Format response                  │ │                                       │     │    │
│  │  │                  ↓                           │ │                                       │     │    │
│  │  │             botMessageText                   │ │                                       │     │    │
│  │  │                  ↓                           │ │                                       │     │    │
│  │  │             Add to chat                      │ │                                       │     │    │
│  │  │                  ↓                           │ │                                       │     │    │
│  │  │             setIsLoading(false)              │ │                                       │     │    │
│  │  └─────────────────────────────────────────────────────────────────────────────────────────┘     │    │
│  │                                                                                                    │    │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────┘    │
│                                                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐    │
│  │  🔧 SERVICE LAYER                                                                                  │    │
│  ├────────────────────────────────────────────────────────────────────────────────────────────────────┤    │
│  │                                                                                                    │    │
│  │  TripService.js                                                                                   │    │
│  │  └─ Location: src/services/TripService.js                                                        │    │
│  │  │                                                                                                │    │
│  │  ├─ Function 1: getGroupTours(filters)                                                          │    │
│  │  │  └─ API Call: GET /view-group-tour?perPage=20&page=1                                        │    │
│  │  │                                                                                                │    │
│  │  ├─ Function 2: getTailorMadeTours(filters)                                                     │    │
│  │  │  └─ API Call: GET /view-custom-tour?perPage=20&page=1                                       │    │
│  │  │                                                                                                │    │
│  │  ├─ Function 3: getTourTypes()                                                                  │    │
│  │  │  └─ API Call: GET /tour-type-list                                                            │    │
│  │  │                                                                                                │    │
│  │  ├─ Function 4: getCities()                                                                     │    │
│  │  │  └─ API Call: GET /city-list                                                                 │    │
│  │  │                                                                                                │    │
│  │  ├─ Function 5: searchTrips(query)                ◄─── MAIN FUNCTION                           │    │
│  │  │  ├─ Call getGroupTours() in parallel                                                         │    │
│  │  │  ├─ Call getTailorMadeTours() in parallel                                                    │    │
│  │  │  ├─ Wait for both responses                                                                  │    │
│  │  │  ├─ Filter group tours for matching keyword                                                  │    │
│  │  │  ├─ Filter tailor-made tours for matching keyword                                            │    │
│  │  │  └─ Return { groupTours, tailorMadeTours, total }                                            │    │
│  │  │                                                                                                │    │
│  │  └─ Function 6: generateTripResponse(searchResults)  ◄─── FORMAT RESULTS                       │    │
│  │     ├─ If total === 0: Return "No tours found"                                                  │    │
│  │     ├─ If groupTours.length > 0:                                                                │    │
│  │     │  └─ Format each tour as:                                                                  │    │
│  │     │     "1. **Tour Name** (Code: ABC-001)"                                                    │    │
│  │     │     "   • Type: Beach"                                                                    │    │
│  │     │     "   • Duration: 7 days"                                                                │    │
│  │     │     "   • Seats: 5/20 booked"                                                              │    │
│  │     │     "   • Dates: 2024-02-10 - 2024-02-17"                                                  │    │
│  │     │                                                                                             │    │
│  │     ├─ If tailorMadeTours.length > 0:                                                            │    │
│  │     │  └─ Format each tour as:                                                                  │    │
│  │     │     "1. **Group Name** (ID: 0001)"                                                        │    │
│  │     │     "   • Type: Custom"                                                                    │    │
│  │     │     "   • Duration: 4D-3N"                                                                 │    │
│  │     │     "   • Dates: 12-02-2024 - 16-02-2024"                                                  │    │
│  │     │                                                                                             │    │
│  │     └─ Return formatted message to display                                                      │    │
│  │                                                                                                    │    │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────┘    │
│                                                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐    │
│  │  🌐 API SERVICE LAYER                                                                              │    │
│  ├────────────────────────────────────────────────────────────────────────────────────────────────────┤    │
│  │                                                                                                    │    │
│  │  apiServices.js                                                                                   │    │
│  │  └─ Location: src/services/apiServices.js                                                        │    │
│  │  │                                                                                                │    │
│  │  ├─ Axios Instance: import.meta.env.VITE_WAARI_BASEURL                                          │    │
│  │  │  └─ Base URL: http://localhost:3000/api                                                      │    │
│  │  │                                                                                                │    │
│  │  ├─ Interceptors:                                                                                │    │
│  │  │  ├─ Request: Adds token header + encrypted clientcode                                        │    │
│  │  │  └─ Response: Handles errors, redirects on 408 (timeout)                                     │    │
│  │  │                                                                                                │    │
│  │  └─ Export Functions:                                                                            │    │
│  │     ├─ get(url, params) - GET requests                                                          │    │
│  │     ├─ post(url, data) - POST requests                                                          │    │
│  │     ├─ put(url, data) - PUT requests                                                            │    │
│  │     └─ del(url) - DELETE requests                                                               │    │
│  │                                                                                                    │    │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────┘    │
│                                                                                                              │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────────┘


                              📡 NETWORK/HTTP REQUEST LAYER
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                              │
│  GET /view-group-tour?perPage=20&page=1            GET /view-custom-tour?perPage=20&page=1                │
│            │                                                      │                                          │
│            ├─ Header: token = JWT_TOKEN                         ├─ Header: token = JWT_TOKEN                │
│            ├─ Header: clientcode = ENCRYPTED                    ├─ Header: clientcode = ENCRYPTED           │
│            └─ Returns: { data: [...], total, perPage, page }    └─ Returns: { data: [...], total }          │
│                                                                                                              │
│  GET /tour-type-list                               GET /city-list                                          │
│            │                                                │                                               │
│            └─ Returns: { data: [...] }                       └─ Returns: { data: [...] }                    │
│                                                                                                              │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────────┘


┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                   🖧 BACKEND (Node.js - Port 3000)                                           │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                              │
│  server.js (Express Server)                                                                                 │
│  └─ Registers all routes at line 128-144                                                                   │
│                                                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐    │
│  │  API ROUTES (src/routes/groupTourRoute.js)                                                         │    │
│  ├────────────────────────────────────────────────────────────────────────────────────────────────────┤    │
│  │                                                                                                    │    │
│  │  Route 1: GET /view-group-tour                                                                    │    │
│  │  ├─ Token Validation: checkToken(token, [32])                                                    │    │
│  │  ├─ Extract Query Params: perPage, page, tourName, tourType, etc.                                │    │
│  │  ├─ Database Query: SELECT * FROM grouptours LIMIT ? OFFSET ?                                    │    │
│  │  └─ Response:                                                                                    │    │
│  │     {                                                                                             │    │
│  │       "data": [                                                                                   │    │
│  │         {                                                                                         │    │
│  │           "groupTourId": 1,                                                                       │    │
│  │           "tourName": "Bali Paradise",                                                            │    │
│  │           "tourCode": "BAL-001",                                                                  │    │
│  │           "tourTypeName": "Beach Tour",                                                           │    │
│  │           "startDate": "2024-02-10",                                                              │    │
│  │           "endDate": "2024-02-17",                                                                │    │
│  │           "duration": 7,                                                                          │    │
│  │           "seatsBook": 5,                                                                         │    │
│  │           "totalSeats": 20                                                                        │    │
│  │         }                                                                                         │    │
│  │       ],                                                                                          │    │
│  │       "total": 25,                                                                                │    │
│  │       "perPage": 10,                                                                              │    │
│  │       "page": 1                                                                                   │    │
│  │     }                                                                                             │    │
│  │                                                                                                    │    │
│  │  ────────────────────────────────────────────────────────────────────────────────────────────    │    │
│  │                                                                                                    │    │
│  │  Route 2: GET /view-custom-tour                                                                   │    │
│  │  ├─ Token Validation: checkToken(token, [110])                                                   │    │
│  │  ├─ Extract Query Params: startDate, endDate, groupName, duration, etc.                          │    │
│  │  ├─ Database Query: SELECT * FROM enquirycustomtours WHERE enquiryProcess = 2                   │    │
│  │  └─ Response:                                                                                    │    │
│  │     {                                                                                             │    │
│  │       "data": [                                                                                   │    │
│  │         {                                                                                         │    │
│  │           "enquiryCustomId": 1,                                                                   │    │
│  │           "uniqueEnqueryId": "0001",                                                              │    │
│  │           "groupName": "Goa Adventure Group",                                                     │    │
│  │           "tourType": "Beach",                                                                    │    │
│  │           "startDate": "12-02-2024",                                                              │    │
│  │           "endDate": "16-02-2024",                                                                │    │
│  │           "duration": "4D-3N"                                                                     │    │
│  │         }                                                                                         │    │
│  │       ],                                                                                          │    │
│  │       "total": 10,                                                                                │    │
│  │       "currentPage": 1,                                                                           │    │
│  │       "perPage": 10,                                                                              │    │
│  │       "lastPage": 1                                                                               │    │
│  │     }                                                                                             │    │
│  │                                                                                                    │    │
│  │  ────────────────────────────────────────────────────────────────────────────────────────────    │    │
│  │                                                                                                    │    │
│  │  Route 3: GET /tour-type-list                                                                     │    │
│  │  ├─ Query: SELECT * FROM tourtype                                                                │    │
│  │  └─ Response: { "data": [...tour types...] }                                                     │    │
│  │                                                                                                    │    │
│  │  Route 4: GET /city-list                                                                          │    │
│  │  ├─ Query: SELECT * FROM city                                                                    │    │
│  │  └─ Response: { "data": [...cities...] }                                                         │    │
│  │                                                                                                    │    │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────┘    │
│                                                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────────────┐    │
│  │  MIDDLEWARE (src/middleware/)                                                                      │    │
│  ├────────────────────────────────────────────────────────────────────────────────────────────────────┤    │
│  │                                                                                                    │    │
│  │  CommonController.checkToken(token, permissionIds)                                                │    │
│  │  ├─ Decode JWT token                                                                             │    │
│  │  ├─ Check if token expired                                                                       │    │
│  │  ├─ Check if user has required permissions                                                       │    │
│  │  └─ Return: { userId, permissions, error? }                                                      │    │
│  │                                                                                                    │    │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────┘    │
│                                                                                                              │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────────┘


┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    🗄️ DATABASE (MySQL - Supabase)                                            │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                              │
│  Table: grouptours                                                                                          │
│  ┌─────────────────────────────────────────────────────────────────────────────┐                            │
│  │ groupTourId | tourName | tourCode | tourTypeName | startDate | endDate | ..│                            │
│  ├─────────────────────────────────────────────────────────────────────────────┤                            │
│  │ 1           | Bali ... | BAL-001  | Beach       | 2024-02-10| 2024-..| ..│                            │
│  │ 2           | Goa ...  | GOA-001  | Beach       | 2024-03-..| 2024-..| ..│                            │
│  └─────────────────────────────────────────────────────────────────────────────┘                            │
│                                                                                                              │
│  Table: enquirycustomtours (Tailor-made tours)                                                              │
│  ┌──────────────────────────────────────────────────────────────────────────────────┐                       │
│  │ enquiryId | groupName | destinationName | startDate | endDate | duration | ...│                       │
│  ├──────────────────────────────────────────────────────────────────────────────────┤                       │
│  │ 1         | Goa Trip  | Goa Beach       | 2024-12-..| 2024-16.| 4D-3N    | ...│                       │
│  └──────────────────────────────────────────────────────────────────────────────────┘                       │
│                                                                                                              │
│  Table: tourtype                                                                                             │
│  ┌──────────────────────────────────────────────────────┐                                                   │
│  │ tourTypeId | tourTypeName | tourTypeImage          │                                                   │
│  └──────────────────────────────────────────────────────┘                                                   │
│                                                                                                              │
│  Table: city                                                                                                 │
│  ┌──────────────────────────────────────────────┐                                                           │
│  │ cityId | cityName | cityImage             │                                                            │
│  └──────────────────────────────────────────────┘                                                           │
│                                                                                                              │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────────┘


╔════════════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                        🔄 COMPLETE FLOW EXAMPLE                                           ║
╠════════════════════════════════════════════════════════════════════════════════════════════════════════════╣
║                                                                                                            ║
║  USER: "Show me tours to Bali"                                                                            ║
║                                                                                                            ║
║  1️⃣  Frontend: AIAssistant.jsx                                                                            ║
║      └─ handleSendMessage()                                                                               ║
║         └─ Check keywords: "tours" found? YES ✓                                                            ║
║            └─ Call searchTrips("Show me tours to Bali")                                                    ║
║                                                                                                            ║
║  2️⃣  Frontend: TripService.searchTrips()                                                                  ║
║      ├─ Call getGroupTours({ perPage: 20 })                                                               ║
║      │  └─ API: GET /api/view-group-tour?perPage=20&page=1                                               ║
║      │     └─ Header: token = JWT_TOKEN                                                                   ║
║      │                                                                                                    ║
║      └─ Call getTailorMadeTours({ perPage: 20 })                                                          ║
║         └─ API: GET /api/view-custom-tour?perPage=20&page=1                                              ║
║            └─ Header: token = JWT_TOKEN                                                                   ║
║                                                                                                            ║
║  3️⃣  Backend: Node.js Express Server                                                                      ║
║      ├─ Route: /view-group-tour                                                                           ║
║      │  └─ checkToken(token, [32]) ✓                                                                      ║
║      │     └─ Query: SELECT * FROM grouptours                                                             ║
║      │        └─ Return: [{ tourName: "Bali...", }, ...]                                                  ║
║      │                                                                                                    ║
║      └─ Route: /view-custom-tour                                                                          ║
║         └─ checkToken(token, [110]) ✓                                                                      ║
║            └─ Query: SELECT * FROM enquirycustomtours WHERE enquiryProcess = 2                           ║
║               └─ Return: [{ groupName: "Bali...", }, ...]                                                 ║
║                                                                                                            ║
║  4️⃣  Frontend: TripService.searchTrips() - Filtering                                                     ║
║      ├─ Filter group tours for "bali" keyword                                                             ║
║      │  └─ matchedGroupTours = [tours with "bali" in tourName]                                            ║
║      │                                                                                                    ║
║      └─ Filter tailor-made tours for "bali" keyword                                                       ║
║         └─ matchedTailorMade = [tours with "bali" in groupName]                                           ║
║         └─ Return { groupTours: [...], tailorMadeTours: [...], total: 2 }                                 ║
║                                                                                                            ║
║  5️⃣  Frontend: TripService.generateTripResponse()                                                         ║
║      ├─ Format group tours:                                                                               ║
║      │  "1. **Bali Paradise** (Code: BAL-001)"                                                            ║
║      │  "   • Type: Beach Tour"                                                                           ║
║      │  "   • Duration: 7 days"                                                                           ║
║      │  "   • Seats: 5/20 booked"                                                                         ║
║      │  "   • Dates: 2024-02-10 - 2024-02-17"                                                             ║
║      │                                                                                                    ║
║      └─ Format tailor-made tours:                                                                         ║
║         "1. **Bali Trip Group** (ID: 0001)"                                                               ║
║         "   • Type: Beach"                                                                                ║
║         "   • Duration: 4D-3N"                                                                            ║
║         "   • Dates: 12-02-2024 - 16-02-2024"                                                             ║
║                                                                                                            ║
║  6️⃣  Frontend: AIAssistant.jsx - Display Response                                                        ║
║      ├─ botMessageText = formatted response                                                                ║
║      ├─ Add to messages array                                                                              ║
║      └─ User sees: "I found 2 trip(s) for you! 🎉"                                                         ║
║         With all the formatted tours displayed                                                             ║
║                                                                                                            ║
╚════════════════════════════════════════════════════════════════════════════════════════════════════════════╝


═════════════════════════════════════════════════════════════════════════════════════════════════════════════
                                        ✨ KEY CONFIGURATIONS ✨
═════════════════════════════════════════════════════════════════════════════════════════════════════════════

Frontend Configuration:
├─ File: d:\Waari\waari-reactjs\.env
└─ VITE_WAARI_BASEURL=http://localhost:3000/api

Backend Configuration:
├─ File: D:\Waari\waari-nodejs\.env
├─ DB_HOST=... (Supabase connection)
├─ DB_USER=...
├─ DB_PASSWORD=...
└─ DB_DATABASE=...

Ports:
├─ Frontend: http://localhost:5173
└─ Backend:  http://localhost:3000

API Authentication:
├─ Method: Token-based (JWT)
├─ Location: request header "token"
└─ Required for all /api endpoints

Trip Keywords Detected:
├─ trip, tour, destination, package, travel
├─ holiday, vacation, itinerary, departure, booking
└─ Case-insensitive matching

═════════════════════════════════════════════════════════════════════════════════════════════════════════════